<!DOCTYPE html>

<!--[if lt IE 7]>    <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>     <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>     <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<title>Using a library</title>
<meta content="" name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<link href="/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/main.css" rel="stylesheet">
<link href="/css/pygments.css" rel="stylesheet">
<link href="/css/asciidoc.css" rel="stylesheet">
<link href="/favicon-192x192.png" rel="icon" sizes="192x192">
<script src="/vendor/modernizr/modernizr.js"></script>
<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create', 'UA-6195355-4', 'auto');ga('send','pageview');
    </script>
</link></link></link></link></link></link></meta></meta></meta></meta></head>
<body>
<!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
<button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="/"><img src="/logo.png"/></a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li><a href="/FIDO2">FIDO2</a></li><li class="active"><a href="/OTP">OTP</a></li><li><a href="/U2F">U2F</a></li><li><a href="/OATH">OATH</a></li><li><a href="/PGP">PGP</a></li><li><a href="/PIV">PIV</a></li><li><a href="/YubiHSM2">YubiHSM2</a></li><li><a href="/Software_Projects">Software Projects</a></li>
</ul>
<!-- Google Custom Search Engine -->
<div class="navbar-form navbar-right" id="search-box">
<script>
          (function() {
            var cx = '017198492754729237489:tcnraf8md8a';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
          })();
          </script>
<gcse:searchbox-only></gcse:searchbox-only>
</div>
<!-- End Google Custom Search Engine -->
</div><!--/.navbar-collapse -->
</div>
</div>
<div class="container">
<div class="row">
<ol class="breadcrumb">
<li><a href="/">Home</a></li>
<li><a href="/OTP">OTP</a></li>
<li><a href="/OTP/Libraries">Libraries</a></li>
<li class="active">Using a library</li>
</ol>
</div>
<div class="row">
<div class="col-md-4" style="padding-left: 0;">
<!-- Sidebar -->
<ul class="nav nav-side well well-sm">
<li class="active"><a href="/OTP">OTP</a><ul class="">
<li><a href="/OTP/Plugins.html">Plugins</a></li>
<li class="active"><a href="/OTP/Libraries">Libraries</a><ul class="">
<li class="active"><a href="/OTP/Libraries/Using_a_library.html">Using a library</a>
<li><a href="/OTP/Libraries/List_of_libraries.html">List of libraries</a></li>
<li><a href="/OTP/Libraries/Creating_your_own_library.html">Creating your own library</a></li>
</li></ul>
<li><a href="/OTP/OTPs_Explained.html">OTPs Explained</a></li>
<li><a href="/OTP/Guides">Guides</a></li>
<li><a href="/OTP/Modhex_Converter.html">Modhex Converter</a></li>
<li><a href="/OTP/Specifications">Specifications</a></li>
</li></ul>
</li></ul>
<!-- End sidebar -->
</div>
<div class="col-md-8">
<!-- Main content -->
<div class="sidelinks">
<ul>
<li><a href="https://github.com/Yubico/developers.yubico.com/issues/new?title=Suggested%20edit%20for%20OTP/Libraries/Using_a_library" rel="noopener noreferrer" target="_blank"><i class="fa fa-pencil-square-o fa-lg"></i> Suggest Edits</a></li>
</ul>
</div>
<div id="page-content">
<div class="sect1">
<h1 id="_using_a_yubico_otp_library">Using a Yubico OTP library</h1>
<div class="sectionbody">
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Yubico OTPs can be validated by YubiCloud or a
<a href="/Software_Projects/Yubico_OTP/YubiCloud_Validation_Servers">self-hosted verification server</a>.
Throughout this document we will refer to both these alternatives simply as <em>YubiCloud</em>.</td>
</tr></table>
</div>
<div class="paragraph"><p>This sequence diagram describes a typical Yubico OTP implementation:</p></div>
<div class="imageblock mscgen">
<div class="content">
<img alt="Using_a_library__1.png" src="Using_a_library__1.png">
</img></div>
</div>
<div class="paragraph"><p>By using a library, you abstract away the communication with YubiCloud (highlighted in blue above).</p></div>
<div class="sect2">
<h3 id="_verifying_otps">Verifying OTPs</h3>
<div class="paragraph"><p>We start by creating a YubiCloud client to be able to send requests to YubiCloud. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="c1"># clientId and secretKey is retrieved from https://upgrade.yubico.com/getapikey</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Yubico</span><span class="p">(</span><span class="n">clientId</span><span class="p">,</span> <span class="n">secretKey</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Now we can verify OTPs:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="c1"># otp is the OTP from the Yubikey</span>
<span class="n">otp_is_valid</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">otp</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>After validating the OTP, you also want to make sure that the YubiKey belongs to the user logging in.
This is done by comparing the first 12 characters of the OTP (which is the YubiKey’s ID) with the
YubiKey ID that is associated with the user:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">otp</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="n">user</span><span class="o">.</span><span class="n">yubikey_id</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_provisioning_yubikeys">Provisioning YubiKeys</h3>
<div class="paragraph"><p>Provisioning is simply a matter of associating the first 12 characters of an OTP with a user in your user database.</p></div>
<div class="listingblock">
<div class="title">Associating a user with a YubiKey ID</div>
<div class="content"><div class="highlight"><pre><span></span><span class="n">user</span><span class="o">.</span><span class="n">yubikey_id</span> <span class="o">=</span> <span class="n">otp</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span>
</pre></div></div></div>
<div class="paragraph"><p>Then, if you are using a SQL database, you might want to store it like this:</p></div>
<table class="table table-bordered table-striped tableblock frame-all grid-all" style="
width:100%;
">
<caption class="title">SQL table example</caption>
<col style="width:50%;">
<col style="width:50%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top">YubiKeyID    </th>
<th class="tableblock halign-left valign-top">   UserId</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ccfucnlcrrne</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1890</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ccnnloposxxc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4371</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cccilddkfopf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2285</p></td>
</tr>
</tbody>
</col></col></table>
<div class="sect3">
<h4 id="_self_provisioning">Self-provisioning</h4>
<div class="paragraph"><p>You can allow users to provision YubiKeys themselves. This is called
<em>self-provisioning</em> and works like this:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
On your website, provide the
option for users to associate a YubiKey with their account. When a user
registers, verify the OTP to make sure that the key is valid.
</p>
</li>
<li>
<p>
Later the user comes back to your site. Since the user has an
associated YubiKey, ask for an OTP (that you verify) before logging
her/him in.
</p>
</li>
</ol></div>
</div>
</div>
<div class="sect2">
<h3 id="_client_side">Client-side</h3>
<div class="paragraph"><p>The client-side (browser-side) is not handled by libraries. Luckily, you just have to add another text field to your existing login form. From a user point of view, <em>press Enter</em> is replaced with <em>touch the YubiKey button</em>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_available_libraries">Available libraries</h2>
<div class="sectionbody">
<div class="paragraph"><p>Have a look at the <a href="List_of_libraries.html">List of libraries</a>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_help">Getting help</h2>
<div class="sectionbody">
<div class="paragraph"><p>Feel free to create a topic in <a href="https://forum.yubico.com/viewforum.php?f=3" rel="noopener noreferrer" target="_blank">our forum</a> or an issue in respective library’s <a href="https://github.com/yubico" rel="noopener noreferrer" target="_blank">GitHub project</a>.</p></div>
</div>
</div>
</div>
<!-- End main content -->
</div>
</div>
</div>
<footer class="container">
<div class="row" style="margin-top:30px;padding-top:20px;border-top:1px solid #eee;">
<div class="col-md-3">
<p style="line-height:2em;font-size:90%">
<strong><a href="https://developers.yubico.com/" style="color:#000">DEV.YUBICO</a></strong><br>
<a href="/FIDO2">FIDO2</a><br>
<a href="/OTP">OTP</a><br>
<a href="/U2F">U2F</a><br>
<a href="/OATH">OATH</a><br>
<a href="/PGP">PGP</a><br>
<a href="/PIV">PIV</a><br>
<a href="/YubiHSM2">YubiHSM2</a><br>
<a href="/Software_Projects">Software Projects</a><br>
</br></br></br></br></br></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong>RESOURCES</strong><br>
<a href="https://store.yubico.com/" rel="noopener noreferrer" target="_blank">Buy YubiKeys</a><br>
<a href="https://www.yubico.com/blog/" rel="noopener noreferrer" target="_blank">Blog</a><br>
<a href="https://www.yubico.com/newsletter/" rel="noopener noreferrer" target="_blank">Newsletter</a><br>
<a href="http://forum.yubico.com/" rel="noopener noreferrer" target="_blank">Yubico Forum Archive</a></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong><a href="https://www.yubico.com/" rel="noopener noreferrer" style="color:#000" target="_blank">YUBICO.COM</a></strong><br>
<a href="https://www.yubico.com/why-yubico/" rel="noopener noreferrer" target="_blank">Why Yubico</a><br>
<a href="https://www.yubico.com/about/about-us/" rel="noopener noreferrer" target="_blank">About Yubico</a></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:1em;font-size:90%"> </p>
<table align="right" cellpadding="0" cellspacing="0" style="color:#9aca3c">
<tbody>
<tr>
<td style="padding:10px"><a href="https://www.yubico.com/feed/" rel="noopener noreferrer" target="_blank" title="Blog RSS"><i class="fa fa-rss"></i></a></td>
<td style="padding:10px"><a href="https://twitter.com/yubico" rel="noopener noreferrer" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></td>
<td style="padding:10px"><a href="https://plus.google.com/114531431015898699937" rel="noopener noreferrer" target="_blank" title="Google Plus"><i class="fa fa-google-plus"></i></a></td>
<td style="padding:10px"><a href="https://www.facebook.com/Yubikey" rel="noopener noreferrer" target="_blank" title="Facebook"><i class="fa fa-facebook"></i></a></td>
<td style="padding:10px"><a href="https://www.youtube.com/c/Yubico" rel="noopener noreferrer" target="_blank" title="YouTube"><i class="fa fa-youtube"></i></a></td>
<td style="padding:10px 0 10px 10px"><a href="https://github.com/Yubico" rel="noopener noreferrer" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>
</tr>
</tbody>
</table>
</div>
</div>
</footer>
<!-- Offset anchor links for navbar -->
<script>
    var shiftWindow = function() { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
  </script>
<script src="/vendor/jquery/dist/jquery.min.js"></script>
<script src="/vendor/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
</body>
</html>