<!DOCTYPE html>

<!--[if lt IE 7]>    <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>     <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>     <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<title>yubihsm-shell</title>
<meta content="" name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<link href="/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/main.css" rel="stylesheet">
<link href="/css/pygments.css" rel="stylesheet">
<link href="/css/asciidoc.css" rel="stylesheet">
<link href="/favicon-192x192.png" rel="icon" sizes="192x192">
<script src="/vendor/modernizr/modernizr.js"></script>
<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create', 'UA-6195355-4', 'auto');ga('send','pageview');
    </script>
</link></link></link></link></link></link></meta></meta></meta></meta></head>
<body>
<!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container">
<div class="navbar-header">
<button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="/"><img src="/logo.png"/></a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li><a href="/FIDO2">FIDO2</a></li><li><a href="/OTP">OTP</a></li><li><a href="/U2F">U2F</a></li><li><a href="/OATH">OATH</a></li><li><a href="/PGP">PGP</a></li><li><a href="/PIV">PIV</a></li><li><a href="/YubiHSM2">YubiHSM2</a></li><li><a href="/Software_Projects">Software Projects</a></li>
</ul>
<!-- Google Custom Search Engine -->
<div class="navbar-form navbar-right" id="search-box">
<script>
          (function() {
            var cx = '017198492754729237489:tcnraf8md8a';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
          })();
          </script>
<gcse:searchbox-only></gcse:searchbox-only>
</div>
<!-- End Google Custom Search Engine -->
</div><!--/.navbar-collapse -->
</div>
</div>
<div class="container">
<div class="row">
<ol class="breadcrumb">
<li><a href="/">Home</a></li>
<li class="active">yubihsm-shell</li>
</ol>
</div>
<div class="row">
<div class="col-md-4" style="padding-left: 0;">
<!-- Sidebar -->
<ul class="nav nav-side well well-sm">
<li class="active"><a href="/yubihsm-shell">yubihsm-shell</a><ul class="">
<li><a href="/yubihsm-shell/Manuals">Manuals</a></li>
<li><a href="/yubihsm-shell/API_Changes.html">API Changes</a></li>
<li><a href="/yubihsm-shell/API_Documentation">API Documentation</a></li>
<li><a href="/yubihsm-shell/libyubihsm.html">libyubihsm</a></li>
<li><a href="/yubihsm-shell/yubihsm-pkcs11.html">yubihsm-pkcs11</a></li>
<li><a href="/yubihsm-shell/yubihsm-shell.html">yubihsm-shell</a></li>
<li><a href="/yubihsm-shell/yubihsm-wrap.html">yubihsm-wrap</a></li>
</ul>
</li></ul>
<!-- End sidebar -->
</div>
<div class="col-md-8">
<!-- Main content -->
<div class="sidelinks">
<ul>
<li><a href="https://github.com/Yubico/yubihsm-shell" rel="noopener noreferrer" target="_blank"><i class="fa fa-github fa-lg"></i> Github</a></li>
</ul>
</div>
<div id="page-content">
<div class="sect1">
<h1 id="_yubihsm_shell">YubiHSM Shell</h1>
<div class="sectionbody">
<div class="paragraph"><p>This repository contains most of the components used to interact with
the YubiHSM 2 at both a user-facing and programmatic level.</p></div>
<div class="paragraph"><p>The available components are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="lib/README.html">libyubihsm</a> — C library to expose low- and high-level functions to
  interact with a YubiHSM
</p>
</li>
<li>
<p>
<a href="src/README.html">yubihsm-shell</a> — thin wrapper around <code>libyubihsm</code> providing both
  an interactive and command-line interface to a YubiHSM
</p>
</li>
<li>
<p>
<a href="pkcs11/README.html">yubihsm-pkcs11</a> — PKCS#11 module using <code>libyubihsm</code>
</p>
</li>
<li>
<p>
<a href="yhwrap/README.html">yubihsm-wrap</a> — command-line tool to create encrypted objects (wraps) that can be imported in the YubiHSM
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_dependencies">Dependencies</h3>
<div class="ulist"><ul>
<li>
<p>
cmake
</p>
</li>
<li>
<p>
cppcheck (optional)
</p>
</li>
<li>
<p>
gcov and lcov (optional)
</p>
</li>
<li>
<p>
gengetopt
</p>
</li>
<li>
<p>
help2man (optional)
</p>
</li>
<li>
<p>
libcrypto
</p>
</li>
<li>
<p>
libcurl
</p>
</li>
<li>
<p>
libedit
</p>
</li>
<li>
<p>
libusb
</p>
</li>
<li>
<p>
libpcsclite (optional)
</p>
</li>
<li>
<p>
llvm/clang and friends
</p>
</li>
<li>
<p>
pkg-config
</p>
</li>
<li>
<p>
pre-commit
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_documentation">Documentation</h3>
<div class="paragraph"><p>Documentation for this project and the YubiHSM 2 in general can be found on Yubico’s <a href="https://developers.yubico.com/YubiHSM2/">developers website</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_pre_commit">pre-commit</h3>
<div class="paragraph"><p>This repository uses <a href="https://pre-commit.com/" rel="noopener noreferrer" target="_blank">pre-commit</a>.</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>pre-commit install
</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_building">Building</h3>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>mkdir build &amp;&amp; cd build
<span class="sh-dollar"></span>cmake ..
<span class="sh-dollar"></span>make
</pre>
</div></div>
<div class="paragraph"><p>Note that <code>ninja</code> builds are available as well:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>mkdir build &amp;&amp; cd build
<span class="sh-dollar"></span>cmake -GNinja ..
<span class="sh-dollar"></span>ninja
</pre>
</div></div>
<div class="paragraph"><p>Manpages are built by default using <code>help2man</code>. It is possible to skip this step with:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>mkdir build &amp;&amp; cd build
<span class="sh-dollar"></span>cmake -DWITHOUT_MANPAGES=1 ..
<span class="sh-dollar"></span>make
</pre>
</div></div>
<div class="paragraph"><p>It is possible to build the libraries and binaries with static linking, this can be enabled with:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>mkdir build &amp;&amp; cd build
<span class="sh-dollar"></span>cmake -DENABLE_STATIC=1 ..
<span class="sh-dollar"></span>make
</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_linting">Linting</h3>
<div class="paragraph"><p>There is a <code>cppcheck</code> target that runs the source through <code>cppcheck</code></p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>make cppcheck
</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_testing">Testing</h3>
<div class="paragraph"><p>PKCS#11 tests can be run using <a href="https://github.com/Yubico/pkcs11test" rel="noopener noreferrer" target="_blank">pkcs11test</a>.</p></div>
<div class="paragraph"><p>The tool must be already built, and the path to the resulting binary
must be in your <code>PATH</code>, or <code>PKCS11TEST_PATH</code> must be set.</p></div>
<div class="paragraph"><p>The programs found in the <code>/examples</code> directory are also used as tests.</p></div>
<div class="paragraph"><p>The tests can be run via</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>make test
</pre>
</div></div>
<div class="paragraph"><p>Or using ctest directly</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>ctest
</pre>
</div></div>
<div class="paragraph"><p>By default the tests expect a local connector running at <code>http://127.0.0.1:12345</code>.
A different connector for the tests can be specified by setting the
<code>DEFAULT_CONNECTOR_URL</code> environment variable.
For example, to run tests using direct USB (i.e., without a connector) use</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>DEFAULT_CONNECTOR_URL="yhusb://" ctest
</pre>
</div></div>
<div class="paragraph"><p>If you are building <code>yubihsm-shell</code> with <code>ninja</code>, the following is available:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>ninja test
</pre>
</div></div>
<div class="paragraph"><p>The test output can be found in <code>.../yubihsm-shell/build/Testing/Temporary/LastTest{,sFailed}.log</code>.</p></div>
<div class="paragraph"><p>Direct command-line output can be obtained with</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>ctest -V
</pre>
</div></div>
<div class="sect3">
<h4 id="_coverage">Coverage</h4>
<div class="paragraph"><p>Code coverage is provided courtesy of lcov and <a href="https://github.com/RWTH-HPC/CMake-codecov" rel="noopener noreferrer" target="_blank">CMake-codecov</a>. This currently only works with <code>make</code> and not with <code>ninja</code>.</p></div>
<div class="paragraph"><p>Enable coverage with</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>cmake -DENABLE_COVERAGE=1 ..
</pre>
</div></div>
<div class="paragraph"><p>You can then build the project normally and run some executables (for example running the tests with <code>make test</code>).</p></div>
<div class="paragraph"><p>At this point coverage evaluation can be generated with gcov/lcov related targets. For example</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>
<span class="sh-dollar"></span>make lcov
</pre>
</div></div>
<div class="paragraph"><p>will generate a single HTML report in <code>./lcov/html/all_targets/index.html</code></p></div>
</div>
</div>
<div class="sect2">
<h3 id="_license">License</h3>
<div class="literalblock">
<div class="content monospaced">
<pre> Copyright 2015-2018 Yubico AB

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.</pre>
</div></div>
</div>
</div>
</div>
</div>
<!-- End main content -->
</div>
</div>
</div>
<footer class="container">
<div class="row" style="margin-top:30px;padding-top:20px;border-top:1px solid #eee;">
<div class="col-md-3">
<p style="line-height:2em;font-size:90%">
<strong><a href="https://developers.yubico.com/" style="color:#000">DEV.YUBICO</a></strong><br>
<a href="/FIDO2">FIDO2</a><br>
<a href="/OTP">OTP</a><br>
<a href="/U2F">U2F</a><br>
<a href="/OATH">OATH</a><br>
<a href="/PGP">PGP</a><br>
<a href="/PIV">PIV</a><br>
<a href="/YubiHSM2">YubiHSM2</a><br>
<a href="/Software_Projects">Software Projects</a><br>
</br></br></br></br></br></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong>RESOURCES</strong><br>
<a href="https://store.yubico.com/" rel="noopener noreferrer" target="_blank">Buy YubiKeys</a><br>
<a href="https://www.yubico.com/blog/" rel="noopener noreferrer" target="_blank">Blog</a><br>
<a href="https://www.yubico.com/newsletter/" rel="noopener noreferrer" target="_blank">Newsletter</a><br>
<a href="http://forum.yubico.com/" rel="noopener noreferrer" target="_blank">Yubico Forum Archive</a></br></br></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:2em;font-size:90%"><strong><a href="https://www.yubico.com/" rel="noopener noreferrer" style="color:#000" target="_blank">YUBICO.COM</a></strong><br>
<a href="https://www.yubico.com/why-yubico/" rel="noopener noreferrer" target="_blank">Why Yubico</a><br>
<a href="https://www.yubico.com/about/about-us/" rel="noopener noreferrer" target="_blank">About Yubico</a></br></br></p>
</div>
<div class="col-md-3">
<p style="line-height:1em;font-size:90%"> </p>
<table align="right" cellpadding="0" cellspacing="0" style="color:#9aca3c">
<tbody>
<tr>
<td style="padding:10px"><a href="https://www.yubico.com/feed/" rel="noopener noreferrer" target="_blank" title="Blog RSS"><i class="fa fa-rss"></i></a></td>
<td style="padding:10px"><a href="https://twitter.com/yubico" rel="noopener noreferrer" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></td>
<td style="padding:10px"><a href="https://plus.google.com/114531431015898699937" rel="noopener noreferrer" target="_blank" title="Google Plus"><i class="fa fa-google-plus"></i></a></td>
<td style="padding:10px"><a href="https://www.facebook.com/Yubikey" rel="noopener noreferrer" target="_blank" title="Facebook"><i class="fa fa-facebook"></i></a></td>
<td style="padding:10px"><a href="https://www.youtube.com/c/Yubico" rel="noopener noreferrer" target="_blank" title="YouTube"><i class="fa fa-youtube"></i></a></td>
<td style="padding:10px 0 10px 10px"><a href="https://github.com/Yubico" rel="noopener noreferrer" target="_blank" title="GitHub"><i class="fa fa-github"></i></a></td>
</tr>
</tbody>
</table>
</div>
</div>
</footer>
<!-- Offset anchor links for navbar -->
<script>
    var shiftWindow = function() { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
  </script>
<script src="/vendor/jquery/dist/jquery.min.js"></script>
<script src="/vendor/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
</body>
</html>